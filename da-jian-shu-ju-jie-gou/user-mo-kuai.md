---
description: æ­å»ºå‚¨å­˜å’Œæ“ä½œç”¨æˆ·ä¿¡æ¯çš„åº•å±‚æ•°æ®ç»“æ„
---

# ğŸ‘¥ Useræ¨¡å—

## å½“å‰è¿›åº¦

```c
.---+- include -+- tools -+- color.h
    |           |         +- hint.h
    |           |         +- info.h
    |           | 
    |           +- user  -+- user.h <---
    |           |
    |           +- config.h <---
    |
    +-   src   -+- tools -+- color.c
                |         +- hint.c
                |         +- info.c 
                |
                +- data  -+- id.txt
                |         +- user.txt <---
                |
                +- user  -+- user.c <---
                |
                +- main.c
```

## è®¾è®¡æ•°æ®ç±»å‹

æ ¹æ®å‰é¢æ‰€è¯´çš„è¦æ±‚ï¼Œæˆ‘ä¹ˆå¯ä»¥åœ¨user.hä¸­å®šä¹‰å¦‚ä¸‹çš„ç”¨æˆ·ç±»å‹ï¼š

```c
// user.h

#include "config.h"

// ç”¨æˆ·çš„ç±»å‹å®šä¹‰
typedef struct {
    char id[MAX_LEN];
    char name[MAX_LEN];
    char passwd[MAX_LEN];
    char contact[MAX_LEN];
    char address[MAX_LEN];
    double balance;
} User;
```

{% hint style="warning" %}
ç»“æ„ä½“å¾ˆå¸¸ç”¨äº†ï¼Œä¸è¿‡ä¸ºäº†ä»¥é˜²ä¸‡ä¸€æœ‰ç”¨æ³•ä¸æ¸…æ™°çš„åœ°æ–¹ï¼Œè¿˜æ˜¯é™„ä¸Šä¸€ä¸ªå‚è€ƒæ•™ç¨‹å§ã€‚

å‚è€ƒæ•™ç¨‹ï¼š[https://www.runoob.com/w3cnote/c-structures-intro.html](https://www.runoob.com/w3cnote/c-structures-intro.html)

ä¹‹åçš„å†…å®¹ä¸­ï¼Œç¬”è€…å°†é»˜è®¤è¯»è€…è‡³å°‘äº†è§£äº†ç»“æ„ä½“çš„åŸºæœ¬ç”¨æ³•ã€‚è‡³äºç»“æ„ä½“å’Œè”åˆä½“çš„æ··åˆåµŒå¥—ä½¿ç”¨ã€ç»“æ„ä½“çš„ä½åŸŸç­‰å…¶ä»–çš„é«˜é˜¶æŠ€å·§æœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ã€‚
{% endhint %}

è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªå¤´æ–‡ä»¶config.hï¼Œè¿™ä¸ªå¤´æ–‡ä»¶æ˜¯å‚¨å­˜ä¸€äº›å…¨å±€è®¾å®šçš„ï¼Œè¿™é‡Œæˆ‘ä»¬çº¦å®šæœ¬é¡¹ç›®ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²é•¿åº¦å‡ä¸è¶…è¿‡`MAX_LEN`ï¼Œæˆ‘ä»¬å°†å…¶å®šä¹‰åœ¨`config.h`ä¸­ã€‚

```c
// config.h
#define MAX_LEN     64
```

éšç€ç¨‹åºçš„ä¸æ–­ä¸°å¯Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦ä¸€äº›å…¶ä»–çš„å…¨å±€è®¾å®šæˆ–è€…çº¦å®šï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ”¾åœ¨`config.h`ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä¹‹åæˆ‘ä»¬è¦æ›´æ”¹è¿™äº›çº¦å®šï¼Œåªéœ€è¦ä¿®æ”¹`config.h`å¤´æ–‡ä»¶å³å¯ã€‚

## é€‰æ‹©æ•°æ®ç»“æ„

æˆ‘é€‰ç”¨äº†æ•°ç»„ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦çº¦å®šç”¨æˆ·çš„æ€»æ•°ä¸è¶…è¿‡`MAX_USER`ï¼Œå¹¶ä¸”åœ¨`config.h`ä¸­å®šä¹‰è¿™ä¸ªå®ã€‚

```c
// config.h
#define MAX_USER    128
```

æˆ‘ä»¬åœ¨`user.c`ä¸­å®šä¹‰è¿™ä¸ªæ•°æ®ç»“æ„ï¼ŒåŒæ—¶å®šä¹‰ç”¨æˆ·çš„åˆå§‹æ€»æ•°ä¸º0ï¼š

```c
#include "user/user.h"

static User users[MAX_USER]; // æ‰€æœ‰çš„ç”¨æˆ·
static int totalUser = 0; // ç”¨æˆ·æ€»æ•°
```

è¿™é‡Œé‡‡ç”¨å…¨å±€æ•°ç»„å’Œå…¨å±€å˜é‡å°†æ•°æ®ç»“æ„å‚¨å­˜ä¸»å­˜çš„é™æ€æ•°æ®åŒºï¼Œè€Œä¸æ˜¯æ ˆåŒºã€‚å› ä¸ºé™æ€æ•°æ®åŒºå˜é‡çš„ç”Ÿå­˜æœŸæ˜¯è´¯ç©¿ç¨‹åºå§‹ç»ˆçš„ï¼Œå¹¶ä¸”é™æ€æ•°æ®çš„ç©ºé—´ä¼šæ¯”æ ˆåŒºå¤§ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œç”¨`static`å…³é”®å­—é™åˆ¶è¿™ä¸¤ä¸ªå˜é‡çš„æ–‡ä»¶ä½œç”¨åŸŸä¸ºæœ¬æ–‡ä»¶å†…ï¼Œè¿™æ ·å°±åªæœ‰useræ¨¡å—æœ¬èº«çš„å‡½æ•°æ–¹æ³•å¯ä»¥è®¿é—®ç€ä¸¤ä¸ªæ•°æ®ç»“æ„äº†ã€‚å¤–éƒ¨æ¨¡å—åªæœ‰é€šè¿‡æœ¬æ¨¡å—æä¾›çš„æ–¹æ³•æˆ–è€…è¯´æ¥å£æ‰èƒ½è¯»å–æˆ–è€…ä¿®æ”¹æ•°æ®å†…å®¹ã€‚

è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ¨¡å—çš„**å°è£…å’ŒæŠ½è±¡**ã€‚

## è®¾è®¡å¯¹å¤–æ¥å£

### æ¥å£è®¾è®¡

æ ¹æ®é¡¹ç›®åˆšå¼€å§‹æ—¶çš„éœ€æ±‚æ±‡æ€»ï¼Œæˆ‘ä»¬å¯¹äºç”¨æˆ·çš„æ•°æ®ç»“æ„æä¾›å¦‚ä¸‹ä¸€äº›æ¥å£ï¼Œå£°æ˜åœ¨`user.h`å¤´æ–‡ä»¶ä¸­ã€‚

```c
// user.h

/**
 * @brief ä»å¤–éƒ¨æ–‡ä»¶å¯¼å…¥ç”¨æˆ·ä¿¡æ¯
 * 
 */
void pullUsers();

/**
 * @brief å°†ç”¨æˆ·ä¿¡æ¯å¯¼å‡ºåˆ°å¤–éƒ¨æ–‡ä»¶
 * 
 */
void pushUsers();

/**
 * @brief è·å–ç”¨æˆ·å¯¹è±¡
 * 
 * @param idex ç”¨æˆ·åœ¨çš„æ•°ç»„ä¸‹æ ‡
 * @return User* æŒ‡å‘å¯¹åº”ç”¨æˆ·çš„æŒ‡é’ˆ
 */
User* getUser(int idex);

/**
 * @brief æ‰“å°è¯¦ç»†çš„ç”¨æˆ·ä¿¡æ¯
 * 
 * @param i ç”¨æˆ·çš„æ•°ç»„ä¸‹æ ‡
 */
void userInfo(int i);

/**
 * @brief æ·»åŠ æ–°ç”¨æˆ·
 * 
 * @param u å¾…æ·»åŠ çš„ç”¨æˆ·æŒ‡é’ˆ
 * @return æ·»åŠ æˆåŠŸè¿”å›1ï¼Œæ·»åŠ å¤±è´¥è¿”å›0
 */
int addUser(User* u);

/**
 * @brief åˆ é™¤ç»™å®šIDçš„ç”¨æˆ·
 * 
 * @param id å¾…åˆ é™¤ç”¨æˆ·çš„id
 * @param who åˆ é™¤æ“ä½œæ‰§è¡Œè€…çš„idï¼Œç®¡ç†å‘˜ä¸ºnull
 * @return int åˆ é™¤æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0
 */
int deleteUser(const char* id, const char* who);

/**
 * @brief æ‰“å°æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯
 * 
 */
void printUsers();

/**
 * @brief æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦åŒ¹é…
 * 
 * @param name ç”¨æˆ·å
 * @param passwd å¯†ç 
 * @param idx å¦‚æœæˆåŠŸï¼Œé€šè¿‡æŒ‡é’ˆè¿”å›ç”¨æˆ·çš„ä¸‹æ ‡
 * @return int åŒ¹é…æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0
 */
int checkPass(const char* name, const char* passwd, int* idx);

/**
 * @brief ç”¨æˆ·å……å€¼ 
 * 
 * @param id å¾…å……å€¼ç”¨æˆ·id
 * @param m å……å€¼æ•°é¢
 * @return å……å€¼æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0
 */
int userTopUp(const char* id, double m);
```

{% hint style="info" %}
å…¶å®æˆ‘ä»¬è®¾è®¡æ¥å£çš„æ—¶å€™å¯èƒ½å¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±èƒ½è€ƒè™‘å…¨é¢çš„ï¼Œå¾€å¾€æ˜¯å…ˆè®¾è®¡ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œåœ¨é¡¹ç›®è¿›è¡Œçš„è¿‡ç¨‹ä¸­å‘ç°ç°æœ‰çš„æ¥å£è¿˜ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæ…¢æ…¢å¾€é‡Œé¢åŠ ä¸€äº›åˆ«çš„æ¥å£ã€‚æœ€ç»ˆæ‰å½¢æˆäº†ä¸Šé¢çš„æˆå½¢çš„æ¥å£è®¾è®¡ã€‚
{% endhint %}

### æ¥å£å®ç°

{% hint style="info" %}
æˆ‘åˆ†é¡¹å±•ç¤ºå„ä¸ªæ¥å£çš„å®ç°æ–¹å¼çš„æ—¶å€™ä¼šå°†å®ç°è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„å¤´æ–‡ä»¶éƒ½åŒ…å«ä»¥ä¸‹ï¼Œä¸è¿‡åœ¨å®é™…çš„`src/user/user.c`æ–‡ä»¶ä¸­åŒä¸€ç§å¤´æ–‡ä»¶åªéœ€è¦åŒ…å«ä¸€æ¬¡å³å¯ã€‚

ä¸€èˆ¬çš„è§„èŒƒæ˜¯å…ˆåŒ…å«è‡ªå®šä¹‰çš„å¤´æ–‡ä»¶ï¼Œå†åŒ…å«ç³»ç»Ÿå¤´æ–‡ä»¶ã€‚

æ¯”å¦‚è¯´ï¼š

```c
// user.c
#include "user/user.h"
#include "tools/info.h"

#include <stdio.h>
#include <string.h>
```

ä¹‹åçš„å„ä¸ªæ¨¡å—ä¸å†é‡å¤ä¸Šè¿°å†…å®¹ã€‚
{% endhint %}

#### ä»å¤–éƒ¨æ–‡ä»¶å¯¼å…¥ä¿¡æ¯

```c
// user.c
#include "user/user.h"

#include <stdio.h>

static const char* filePath = "src/data/user.txt";

void pullUsers() {
    totalUser = 0; // å‰é¢å·²ç»å®šä¹‰
    FILE* pf = fopen(filePath, "r");
    if (pf) {
        while (fscanf(pf, "%s%s%s%s%s%lf", users[totalUser].id, \
users[totalUser].name, users[totalUser].passwd, users[totalUser].contact, \
users[totalUser].address, &(users[totalUser].balance)) != EOF) totalUser++;
        fclose(pf);
    }
}
```

> æˆ‘ä»¬çº¦å®šï¼Œç”¨æˆ·çš„ä¿¡æ¯å‚¨å­˜åœ¨æ–‡ä»¶src/data/user.txtä¸­ã€‚å¦å¤–ï¼Œåˆ«å¿˜äº†åŒ…å«`user.h`å¤´æ–‡ä»¶ï¼ŒåŒ…å«å…¶ç›¸å¯¹äº`include`æ–‡ä»¶å¤¹çš„ç›¸å¯¹è·¯å¾„ã€‚

è¿™é‡Œä½¿ç”¨`static`å…³é”®å­—ï¼Œå°†`filePath`çš„ä½œç”¨åŸŸé™åˆ¶åœ¨æœ¬æ¨¡å—å†…éƒ¨ï¼ˆCè¯­è¨€ä»¥`.c`æ–‡ä»¶ä½œä¸ºæ¨¡å—åˆ’åˆ†çš„åŸºæœ¬å•ä½ï¼‰ï¼Œè¿™æ ·åœ¨å…¶ä»–æ¨¡å—é‡Œé¢å°±å¯ä»¥ç»§ç»­ä½¿ç”¨`filePath`è¿™ä¸ªæ ‡è¯†ç¬¦ä½œä¸ºæ–‡ä»¶è·¯å¾„çš„å¸¸é‡åäº†ã€‚

è¿™ç§æ‰‹æ³•åœ¨ç¼–å†™ç•Œé¢æ¨¡å—çš„æ—¶å€™ä¼šä½“ç°çš„æ·‹æ¼“å°½è‡´ï¼Œå¯ä»¥æœŸå¾…ä¸€ä¸‹:smile:ã€‚

#### å°†ç”¨æˆ·ä¿¡æ¯å¯¼å‡ºåˆ°å¤–éƒ¨æ–‡ä»¶

```c
// user.c
#include "user/user.h"

#include <stdio.h>

void pushUsers() {
    FILE* pf = fopen(filePath, "w");
    for (int i = 0; i < totalUser; i++)
        fprintf(pf, "%s %s %s %s %s %.1f\n", users[i].id, users[i].name, users[i].passwd, \
users[i].contact, users[i].address, users[i].balance);
    fclose(pf);
}
```

> ä¸ºäº†é¿å…æµ®ç‚¹æ•°æ‰“å°ç²¾åº¦ä¸ç¡®å®šå¯¼è‡´æ‰“å°æ ¼å¼ä¸ç»Ÿä¸€çš„é—®é¢˜ï¼Œæˆ‘ä»¬çº¦å®šåœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæ‰€æœ‰çš„æµ®ç‚¹æ•°ä¿ç•™å°æ•°ç‚¹å1ä½ã€‚å“ªæ€•ç”¨æˆ·è¾“å…¥äº†æ›´é«˜ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œå› ä¸ºæ‰“å°è§„æ ¼ç¬¦ç»Ÿä¸€ä½¿ç”¨`.1f`ï¼Œæ•…è€Œå½“è¯¥è¾“å…¥è¢«æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„æ—¶å€™æ€»æ˜¯1ä½å°æ•°ã€‚åŒæ—¶ï¼Œåœ¨ç»å†ä¸€æ¬¡æ–‡ä»¶è¯»å†™ä¹‹åï¼Œå®é™…ç²¾åº¦ä¹Ÿä¼šå˜æˆä¸€ä½å°æ•°ã€‚

#### è·å–ç”¨æˆ·å¯¹è±¡

```c
User* getUser(int idex) { return users + idex; }
```

{% hint style="warning" %}
è¿™é‡Œæ¶‰åŠåˆ°äº†Cè¯­è¨€æŒ‡é’ˆç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œåç»­çš„å†…å®¹ä¸­ä¹Ÿä¼šæ¶‰åŠæŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœè¿˜ä¸å¤ªç†Ÿæ‚‰çš„è¯å¯ä»¥å¯»æ‰¾æ•™ç¨‹å¤ä¹ ä¸€ä¸‹ã€‚

å‚è€ƒæ•™ç¨‹ï¼š[https://www.runoob.com/w3cnote/c-pointer-detail.html](https://www.runoob.com/w3cnote/c-pointer-detail.html)

åç»­çš„å†…å®¹ä¸­ç¬”è€…å°†é»˜è®¤è¯»è€…æŒæ¡äº†æŒ‡é’ˆçš„å«ä¹‰ä»¥åŠåŸºæœ¬è¿ç®—ã€‚
{% endhint %}

#### æ‰“å°è¯¦ç»†çš„ç”¨æˆ·ä¿¡æ¯

```c
// user.c
#include "user/user.h"

#include <stdio.h>

void userInfo(int i) {
    printf("ID:        | %s\n", users[i].id);
    printf("Name:      | %s\n", users[i].name);
    printf("Contact:   | %s\n", users[i].contact);
    printf("Address:   | %s\n", users[i].address);
    printf("Balance:   | %.1f\n", users[i].balance);
}
```

> æ‰“å°å†…å®¹éœ€è¦æ³¨æ„å¯¹é½å’Œç¾è§‚ã€‚

#### æ·»åŠ æ–°ç”¨æˆ·

```c
// user.c
#include "user/user.h"
#include "tools/info.h"

#include <string.h>

/**
 * @brief æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
 * 
 * @param name å¾…æŸ¥æ‰¾çš„ç”¨æˆ·å
 * @return int æŸ¥æ‰¾æˆåŠŸè¿”å›æ•°ç»„ä¸‹æ ‡ï¼Œå¤±è´¥è¿”å›-1
 */
static int searchUserName(const char* name) {
    for (int i = 0; i < totalUser; i++)
        if (strcmp(users[i].name, name) == 0) return i;
    return -1;
}

int addUser(User* u) {
    if (totalUser == MAX_USER) return 0;
    if (searchUserName(u->name) != -1) return 0;
    genID(u->id, 'U');
    users[totalUser++] = *u;
    return 1;
}
```

> å› ä¸ºè¿™é‡Œç”¨åˆ°äº†`genID`å‡½æ•°æ¥ç”Ÿæˆæ–°ç”¨æˆ·çš„IDï¼Œæ‰€ä»¥éœ€è¦åŒ…å«`info.h`å¤´æ–‡ä»¶ã€‚å½“ç„¶ï¼Œç”¨åˆ°äº†å­—ç¬¦ä¸²å¤„ç†çš„åº“å‡½æ•°ï¼Œè‡ªç„¶ä¹Ÿéœ€è¦åŒ…å«`string.h`å¤´æ–‡ä»¶ã€‚

è¿™é‡Œå€¼å¾—æä¸€ä¸‹çš„æ˜¯ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²çš„èµ‹å€¼éƒ½ä¸å¯ä»¥ç›´æ¥ç”¨ç­‰å·ï¼Œè€Œåº”å½“ä½¿ç”¨`strcpy`å‡½æ•°ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯å¤æ‚æ•°æ®ç±»å‹ï¼Œå˜é‡ä¸­å­˜çš„åªæ˜¯é¦–åœ°å€ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²æœ¬èº«ã€‚ä¸è¿‡ç»“æ„ä½“æ˜¯å¯ä»¥ç›´æ¥èµ‹å€¼çš„ã€‚ç»“æ„ä½“èµ‹å€¼çš„åŸåˆ™æ˜¯å°†æ•´ä¸ªç»“æ„ä½“æ‰€æŒ‡å‘çš„å†…å­˜ç›´æ¥æ‹·è´ã€‚

> å½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥èµ‹å€¼å…¶å®å–å†³ä¸æˆ‘ç»“æ„ä½“ä¸­æ•°ç»„çš„å®šä¹‰æ–¹å¼ã€‚

{% hint style="info" %}
æˆ‘ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```c
typedef struct {
    char name[12];
    int age;
} School;
```

å®šä¹‰ä¸¤ä¸ªä¸Šè¿°ç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼š

```c
School p1 = {"nju", 120}, p2;
```

ç„¶åæˆ‘ä»¬å°†p1èµ‹å€¼ç»™p2:

```c
p2 = p1;
```

å…¶å®ä¸Šé¢çš„èµ‹å€¼æ“ä½œå°±ç›¸å½“äºï¼š

```c
#include <string.h>
memcpy(&p2, &p1, sizeof(School));
// æ­¤å¤„çš„sizeof(School) = 16
```

ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘è¿™æ ·å®šä¹‰ç»“æ„ä½“ï¼š

```c
typedef struct {
    char* name;
    int age;
} School;
```

ç›´æ¥èµ‹å€¼çš„æ—¶å€™å°±ä¸æ˜¯æ‹·è´å­—ç¬¦ä¸²ï¼Œè€Œåªæ˜¯æ‹·è´å­—ç¬¦æŒ‡é’ˆäº†ã€‚å› ä¸ºï¼Œæ­¤æ—¶ï¼š

```c
sizeof(School) = 8; // è€Œä¸æ˜¯12äº†
```


{% endhint %}

å› ä¸ºæˆ‘ä»¬éœ€è¦ä¿è¯æ‰€æœ‰çš„ç”¨æˆ·ç”¨æˆ·åä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ª`searchUserName`å‡½æ•°æ¥æŸ¥æ‰¾ç”¨æˆ·åï¼Œåªæœ‰æ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œæ‰å¯ä»¥ä¸ºè¿™ä¸ªæ–°çš„ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªç‹¬ç‰¹çš„`ID`å¹¶æŠŠæ–°ç”¨æˆ·æ”¾åˆ°æˆ‘ä»¬çš„æ•°ç»„ä¸­å»ã€‚

å› ä¸ºè¿™ä¸ª`searchUserName`å…¶å®åªåœ¨`addUser`å‡½æ•°ä¸­ç”¨åˆ°äº†ï¼Œç›¸å½“äºæ·»åŠ æ–°ç”¨æˆ·çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦ç”¨æˆ·å·²å­˜åœ¨çš„ä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œå› æ­¤ä½¿ç”¨`static`å…³é”®å­—å°†å…¶ä½œç”¨åŸŸé™åˆ¶åœ¨æœ¬æ¨¡å—å†…ï¼Œå¹¶ä¸”ä¸åœ¨å¤´æ–‡ä»¶ä¸­ç»™å¤„è¯¥å‡½æ•°çš„å£°æ˜ã€‚

{% hint style="warning" %}
æ­¤å¤„ï¼Œä½ éœ€è¦ç†è§£æ¨¡å—æŠ½è±¡ã€å°è£…çš„è¿‡ç¨‹å’Œæ‰‹æ³•ï¼Œåœ¨åé¢çš„æ•™ç¨‹ä¸­ç›¸ä¼¼çš„å†…å®¹æˆ‘å°†ä¸å†é‡å¤ã€‚
{% endhint %}

#### åˆ é™¤ç»™å®šIDçš„ç”¨æˆ·

```c
// user.c
#include "user/user.h"

#include <string.h>

/**
 * @brief æŸ¥æ‰¾ç»™å®šIDçš„ç”¨æˆ·
 * 
 * @param id éœ€è¦æŸ¥æ‰¾çš„ç”¨æˆ·ID
 * @return int æˆåŠŸè¿”å›ä¸‹æ ‡ï¼Œå¤±è´¥è¿”å›-1
 */
static int searchUserID(const char* id) {
    for (int i = 0; i < totalUser; i++)
        if (strcmp(users[i].id, id) == 0) return i;
    return -1;
}

int deleteUser(const char* id, const char* who) {
    if (who) return 0;
    int idx = searchUserID(id);
    if (idx == -1) return 0;
    for (int j = idx; j < totalUser - 1; j++) users[j] = users[j+1];
    totalUser--;
    return 1;
}
```

> `who`ä¸­å­˜æ”¾çš„æ˜¯è¡Œä¸ºä¸»ä½“çš„IDï¼Œåªæœ‰ç®¡ç†å‘˜æœ‰æƒé™åˆ é™¤ç”¨æˆ·ï¼ˆç®¡ç†å‘˜IDä¸º`NULL`ï¼‰ã€‚

#### æ‰“å°æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯

```c
// user.c
#include "user/user.h"
#include "tools/info.h"

#include <stdio.h>

static const char* header = "|ID         |Name       |Contact    |Address    |Balance    |";
static const char* divide = "+-----------+-----------+-----------+-----------+-----------+";

/**
 * @brief æ‰“å°å•ä¸ªç”¨æˆ·ä½œä¸ºè¡¨æ ¼çš„ä¸€è¡Œ
 * 
 * @param i ç”¨æˆ·ä¸‹æ ‡
 */
static void printUser(int i) {
    printf("|%-10s |%-10s |%-10s |%-10s |%-10.1f |\n", users[i].id, users[i].name, \
users[i].contact, users[i].address, users[i].balance);
}

void printUsers() {
    print_header
    for (int i = 0; i < totalUser; i++) {
        printUser(i);
        print_divide
    }
}
```

è¿™é‡Œæˆ‘ä»¬å°†è¡¨å¤´`header`å’Œè¡¨æ ¼åˆ†å‰²çº¿`divide`æŠ½è±¡å‡ºæ¥ï¼Œä½œä¸ºä¸¤ä¸ªæ¨¡å—å±€éƒ¨å˜é‡ï¼Œåœ¨`Good`å’Œ`Order`æ¨¡å—ä¸­ä¹Ÿæœ‰ç›¸åŒåç§°çš„å±€éƒ¨å˜é‡ã€‚

è¿™æ ·è®¾è®¡æ˜¯ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæé«˜é€šç”¨æ€§ï¼Œå› ä¸ºè¡¨å¤´å’Œåˆ†å‰²çº¿ä¼šè¢«ä½¿ç”¨å¾ˆå¤šæ¬¡ï¼ˆè¿™ä¸ªæ¨¡å—ä¸æ˜æ˜¾ï¼Œå› ä¸ºåªæœ‰ç®¡ç†å‘˜æœ‰æƒé™æŸ¥çœ‹æ‰€æœ‰çš„ç”¨æˆ·ï¼Œä¸è¿‡åœ¨Goodæ¨¡å—çš„æ—¶å€™ï¼Œä¹°å®¶ã€å–å®¶å’Œç®¡ç†å‘˜æŸ¥çœ‹åˆ°çš„å•†å“åˆ—è¡¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¹Ÿå°±éœ€è¦å¾ˆå¤šä¸åŒçš„printå‡½æ•°ï¼Œæ‰€ä»¥ä¼šé‡å¤çš„è¦ç”¨åˆ°è¡¨å¤´å’Œåˆ†éš”ç¬¦ï¼‰ã€‚

```c
// tools/info.h

// helper macro for print
#define print_header \
    printf("%s\n", divide);\
    printf("%s\n", header);\
    printf("%s\n", divide);

#define print_divide \
    printf("%s\n", divide);
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å°†æ‰“å°è¡¨å¤´å’Œæ‰“å°åˆ†éš”ç¬¦çš„æ“ä½œå°è£…æˆäº†ä¸¤ä¸ªå®`print_header`å’Œ`print_divide`ï¼Œæ”¾åœ¨`info.h`å¤´æ–‡ä»¶ä¸­ã€‚åœ¨æ‰€æœ‰çš„æ•°æ®ç»“æ„æ¨¡å—ä¸­éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªå®ã€‚

å› ä¸º`header`å’Œ`divide`éƒ½æ˜¯`static`ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„æ•°æ®ç»“æ„æ¨¡å—é‡Œé¢ä½¿ç”¨è¿™ä¸¤ä¸ªå®ï¼Œæ‰€æŒ‡å‘çš„`header`å’Œ`divide`éƒ½æ˜¯æ¨¡å—å†…è‡ªå·±å®šä¹‰çš„é‚£ä¸¤ä¸ªï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå®åªéœ€è¦å®šä¹‰ä¸€éå°±å¯ä»¥ä¾›ä¸‰ä¸ªæ•°æ®ç»“æ„æ¨¡å—å¤šæ¬¡ä½¿ç”¨ï¼Œå¤§å¤§å‡å°‘äº†ä¸å¿…è¦çš„é‡å¤æ€§çš„ä»£ç ã€‚

{% hint style="warning" %}
è¿™ä¸ªåœ°æ–¹æœ€å¥½èƒ½å¤Ÿé©»è¶³æ€è€ƒä¸€ä¸‹è¿™ç§å¤„ç†æ–¹å¼â€”â€”â€”åˆ©ç”¨é¢„å¤„ç†é˜¶æ®µå®å±•å¼€çš„æ€§è´¨ç²¾ç®€ä»£ç ã€åˆ©ç”¨staticæ–‡ä»¶ä½œç”¨åŸŸçš„ç‰¹æ€§ä¿æŒå®å¯¹äºå¤šä¸ªæ¨¡å—çš„å®ç”¨æ€§ä¸æ³›åŒ–ç‰¹æ€§ã€‚

è¿™ä¸ªåœ°æ–¹åªæ˜¯ä¸€ä¸ªprintçš„ä¼˜åŒ–å¤„ç†ï¼Œåœ¨å†™interfaceæ¨¡å—çš„æ—¶å€™ä½ ä¼šå‘ç°è¿™æ ·çš„å¤„ç†èƒ½å¤Ÿç²¾ç®€ç‰¹åˆ«å¤šä¸å¿…è¦çš„é‡å¤ä»£ç ä¹¦å†™ã€‚

æ‰€ä»¥åœ¨ç»§ç»­ä¹‹å‰è¿˜è¯·ç¨å¾®ç†è§£ä¸€ä¸‹è¿™æ ·çš„å¤„ç†æ–¹å¼ã€‚
{% endhint %}

{% hint style="warning" %}
åœ¨è¿™ä¸ªéƒ¨åˆ†è¿˜ç”¨åˆ°äº†printfå‡½æ•°çš„å„ç§æ ¼å¼åŒ–è¾“å‡ºçš„åŠŸèƒ½ï¼Œå¦‚æœå¯¹äºæ¨¡å¼ä¸²å«ä¹‰è¿˜ä¸æ¸…æ™°çš„è¯å¯ä»¥å¯»æ‰¾ç›¸å…³æ•™ç¨‹å¤ä¹ ä¸€ä¸‹ã€‚

å‚è€ƒæ•™ç¨‹ï¼š [https://www.runoob.com/cprogramming/c-function-printf.html](https://www.runoob.com/cprogramming/c-function-printf.html)

ä¹‹åçš„å†…å®¹ä¸­ç¬”è€…ä¼šé»˜è®¤å„ä½æ¸…æ¥šäº†printfæ¨¡å¼ä¸²ä¸­å„ç§è§„å®šç¬¦çš„å«ä¹‰ã€‚
{% endhint %}

#### æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦åŒ¹é…

```c
// user.c
#include <string.h>

int checkPass(const char* name, const char* passwd, int* idx) {
    *idx = searchUserName(name);
    if (*idx == -1) return 0;
    return strcmp(users[*idx].passwd, passwd) == 0;
}
```

è¿™é‡Œé™¤äº†è¿”å›å¯†ç åŒ¹é…æ˜¯å¦æˆåŠŸä¹‹å¤–ï¼Œè¿˜éœ€è¦è¿”å›å’Œå“ªä¸€ä¸ªç”¨æˆ·åŒ¹é…æˆåŠŸäº†ã€‚

{% hint style="info" %}
ä¸€ä¸ªå‡½æ•°å°±åªèƒ½æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æŒ‡é’ˆå‚æ•°æ¥è¿”å›åˆ°åº•å’Œå“ªä¸€ä¸ªç”¨æˆ·åŒ¹é…æˆåŠŸäº†ã€‚

å½“æˆ‘ä»¬è¦åé¦ˆä¸æ­¢ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œé™¤äº†å‡½æ•°è¿”å›å€¼ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¯‰è¯¸äºæŒ‡é’ˆï¼Œé€šè¿‡ä¼ å€è°ƒç”¨çš„æ–¹å¼åˆ©ç”¨å‡½æ•°çš„å‰¯ä½œç”¨è¿”å›æ•°æ®ã€‚
{% endhint %}

#### ç”¨æˆ·å……å€¼

```c
int userTopUp(const char* id, double m) {
    int idx = searchUserID(id);
    if (idx == -1) return 0;
    users[idx].balance += m;
    return 1;
}
```

{% hint style="success" %}
è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·æ•°æ®ç»“æ„æ¨¡å—çš„è®¾è®¡ã€‚æä¾›äº†ä¸€äº›å¾ˆæ–¹ä¾¿ä½¿ç”¨çš„å¤–éƒ¨æ¥å£ï¼Œç­‰åˆ°æˆ‘ä»¬ä¹‹åå†™äº¤äº’ç•Œé¢çš„æ—¶å€™å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨è¿™äº›æ¥å£äº†ã€‚å†æ¥å†å‰ï¼Œæˆ‘ä»¬ä¸‹é¢å†™ä¸€ä¸‹å•†å“æ¨¡å—ã€‚
{% endhint %}
